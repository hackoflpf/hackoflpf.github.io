<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="hackoflpf在 Github 上的个人博客">
    <meta name="keyword" content="">
    <meta name="theme-color" content="#600090">
    <meta name="msapplication-navbutton-color" content="#600090">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="#600090">
    <link rel="shortcut icon" href="https://cdn4.iconfinder.com/data/icons/ionicons/512/icon-person-128.png">
    <link rel="alternate" type="application/atom+xml" title="Hackoflpf" href="/atom.xml">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css">
    <link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.css">
    <title>
        
        winafl初探｜hackoflpf&#39;s blog
        
    </title>

    <link rel="canonical" href="http://hackoflpf.github.io/2020/02/22/afl_fuzz/">

    <!-- Bootstrap Core CSS -->
    
<link rel="stylesheet" href="/css/bootstrap.min.css">


    <!-- Custom CSS -->
    
<link rel="stylesheet" href="/css/blog-style.css">


    <!-- Pygments Github CSS -->
    
<link rel="stylesheet" href="/css/syntax.css">

<meta name="generator" content="Hexo 4.2.0"></head>

<style>

    header.intro-header {
        background-image: url('')
    }
</style>
<!-- hack iOS CSS :active style -->
<body ontouchstart="" class="animated fadeIn">
<!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top " id="nav-top" data-ispost = "true" data-istags="false
" data-ishome = "false" >
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand animated pulse" href="/">
                <span class="brand-logo">
                    Hackoflpf
                </span>
                's Blog
            </a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <!-- Known Issue, found by Hux:
            <nav>'s height woule be hold on by its content.
            so, when navbar scale out, the <nav> will cover tags.
            also mask any touch event of tags, unfortunately.
        -->
        <!-- /.navbar-collapse -->
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">Home</a>
                    </li>
					
                    
                        
                    
                        
							
                        <li>
                            <a href="/Tags/index-1.html">Tags</a>
                        </li>
							
						
                    
                        
                    
                        
							
                        <li>
                            <a href="/about/">Whoami</a>
                        </li>
							
						
                    
                        
                    
					
					
                </ul>
            </div>
        </div>
    </div>
    <!-- /.container -->
</nav>
<script>
    // Drop Bootstarp low-performance Navbar
    // Use customize navbar with high-quality material design animation
    // in high-perf jank-free CSS3 implementation
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        // CLOSE
            $navbar.className = " ";
            // wait until animation end.
            setTimeout(function(){
                // prevent frequently toggle
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        // OPEN
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>

<!-- Main Content -->

<!--only post-->


<img class="wechat-title-img"
     src="null/img/death_note.jpg">


<style>
    
    header.intro-header {
        background-image: url('/img/death_note.jpg?imageView2/1/w/1400/h/400/interlace/1/q/90')
    }

    
</style>

<header class="intro-header">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1 text-center">
                <div class="post-heading">
                    <h1>winafl初探</h1>
                    
                    <span class="meta">
                         作者 hackoflpf
                        <span>
                          日期 2020-02-22
                         </span>
                    </span>
                    <div class="tags text-center">
                        
                        <a class="tag" href="/tags/#fuzz"
                           title="fuzz">fuzz</a>
                        
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="post-title-haojen">
        <span>
            winafl初探
        </span>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">
            <!-- Post Container -->
            <div class="col-lg-8 col-lg-offset-1 col-sm-9 post-container">
                <h2 id="目前找到的部分关于winafl的研究">目前找到的部分关于winafl的研究</h2>
<p><a href="https://paper.seebug.org/323/" target="_blank" rel="noopener">初识 Fuzzing 工具 WinAFL</a></p>
<p><a href="https://www.freebuf.com/articles/system/216437.html" target="_blank" rel="noopener">模糊测试工具WinAFL使用指南</a></p>
<p><a href="https://github.com/ivanfratric/winafl" target="_blank" rel="noopener">winafl 官方网站</a></p>
<p><a href="https://rk700.github.io/tags/#fuzzing" target="_blank" rel="noopener">winafl小试,包含了对afl的整体介绍以及对fuzz策略的改进</a></p>
<h2 id="关于fuzzing的简单介绍">关于fuzzing的简单介绍</h2>
<p>按输入用例获取方式的不同，一般可分为基于突变的 dumb fuzzing 、基于生成的 smart fuzzing 和基于进化算法的 fuzzing 。</p>
<h2 id="使用winafl进行fuzz">使用winafl进行fuzz</h2>
<p>在这里使用winafl来fuzz目标程序。Winafl是一个文件格式及协议漏洞的半自动发现工具，可以帮助我们发现各种使用特定格式文件的应用软件漏洞 。winafl的具体介绍可以查看官网或者其他对afl进行分析的博客。这里说明下我用winafl的具体过程。</p>
<h3 id="遇到的问题">遇到的问题</h3>
<p>我在使用winafl的时候遇到了一些问题，首先是关于DynamoRIO的，由于windows上的大部分应用程序都是预先编译好的没有源码的二进制程序，因此为了获取程序的覆盖率，winafl使用DynamoRIO进行动态插桩来获取fuzz过程中的程序覆盖率，从而调整变异策略。我在win10的虚拟机上使用了DynamoRIO的发行版，可以在<a href="https://github.com/DynamoRIO/dynamorio/wiki/Downloads" target="_blank" rel="noopener">这里</a>下到。但是发现程序并没有正常运行，通过运行<code>ddrun notepad</code>命令并没有启动notepad，但是通过-v进行详细输出并没有发现任何问题。显示如下：<br>
<img src="/img/afl1.png" alt=""></p>
<p>可以看出，整个输出显示并没有任何问题，但是notepad并没有成功运行。由于没法确定问题到底出在什么地方，我只能以start failed，no response等关键字进行查找，但并没有找到原因。这里初步怀疑可能是我自己win10环境的问题，因此我换了多个虚拟机环境进行测试，同时在win10本地使用vs2017+cmake3.17进行编译，尝试运行后出现了其它问题，比如说可以对简单的notepad进行动态插桩，但对于复杂的应用似乎有点力不从心，连基本的GUI都无法正常显示，最后我重新安装了win7原版的虚拟机，并且可以使用DynamoRIO的发行版以及自己编译后的版本。但是为了找到更深层次的软件失败的原因，我使用了火绒剑、procmonitor等行为监控工具来对比成功与失败的不同，确实发现了一些问题。</p>
<p>首先，对官方提供的编译后的版本进行测试。通过火绒剑、procmonitor监控drrun.exe的运行，经过对比后，发现主要的不同在于drrun尝试打开目标程序后的行为。正确的行为是drrun通过CreateProcess来创建客户程序，并通过drinjectlib.dll向客户程序注入dynamorio.dll，由dynamorio.dll完成插桩前的一些初始化的工作，通过行为监控工具查看正常的注入结果，显示如下：</p>
<p><img src="/img/afl2.png" alt=""></p>
<p>在失败的注入中，drrun在创建了客户端程序后，就直接推出了。此时依旧无法确定问题的真正原因，猜测是加载的dynamorio.dll出现了问题，导致应用程序崩溃，查看eventviewer，果然找到了对应的事件。</p>
<p><img src="/img/afl3.png" alt=""></p>
<p>可以看出错误代码是c0000005，属于应用程序访问内存异常，接下来通过windbg来对drrun进行粗略的调试，发现问题出现在 <b style="color: #FF0000 "> <strong>dynamorio!ntdll_redir_fls_init</strong> </b>代码中，通过issue搜索发现有人提交过该问题，是由于在win10上获取特定结构体内容时同版本不一致导致了<b style="color: #FF0000 "> access  violation</b> ,在这里笔者并没有继续深究下去，因为通过自己编译的版本是可以在win10上运行的，但是在应对稍显复杂的程序上出现了问题。同时另外一个疑问就是为何在新安装的win7上可以正常使用，但在旧的虚拟机中却无法运行。在这里同样利用windbg进行调试，经过层层运行，最后发现了如下的可疑代码：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">16351c5f 16              push    ss</span><br><span class="line">16351c60 9c              pushfd</span><br><span class="line">16351c61 f0ff0530111b00  lock inc dword ptr ds:[1B1130h] ds:002b:001b1130&#x3D;00000000</span><br><span class="line">16351c68 60              pushad</span><br><span class="line">16351c69 6865111b00      push    1B1165h</span><br><span class="line">16351c6e e9ebfcfdff      jmp     1633195e</span><br></pre></td></tr></table></figure>
<p>首先这段代码的地址并没有在相关模块附近，笔者猜测很可能是其它软件或者防火墙添加的hook代码，通过查看调用堆栈发现它最初来自于 <b style="color: red ">dtrampo.dll</b> ，突然想到这个模块似乎是火绒的模块，查看信息果然是，看来应该是火绒剑同DR的冲突导致了注入的代码无法正常运行，在这里只能先卸载火绒后，重新运行drrun进行测试，发现果然可以正常运行了，至此问题基本得到了解决,虽然还有部分问题如在win10上出现safe_read_asm_mid函数在拷贝数据时出现访问异常导致crash，原因是上层函数传入了错误的指针，但并没有再花更多的时间去解决，在github上也有人提出类似问题，似乎不用理会。接下来就是利用winafl进行相关的测试了。</p>
<h3 id="选取jisupdf作为测试程序">选取jisupdf作为测试程序</h3>
<h4 id="寻找攻击面">寻找攻击面</h4>
<p>网络上有非常多的文章介绍关于对pdf文件漏洞格式进行fuzz的，大部分是关于fuzz相关的解析pdf的库函数，但是在这里通过逆向分析、调试发现jisupdf程序并没有一个独立的库用来fuzz。因此直接fuzz它的GUI主程序。根据winafl对应的 DynamoRIO 插桩模式的文档，首先需要找到一个合适的函数位置用来进行插桩以及fuzz，通过动态监测找到了两个打开目标pdf文件的函数地址，进行逆向分析后，确定其中一个为待fuzz的函数，另外一个主要功能是计算md5 hash，和解析pdf格式无关。winafl中对fuzz函数有着一定要求：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1.必须保证在fuzz目标程序的过程中一定命中对应的函数偏移。</span><br><span class="line">2.目标函数必须包含解析文件或者处理用户输入的功能，这样winafl就可以通过程序的覆盖率来进行变异。</span><br><span class="line">3.针对解析文件格式的fuzz，必须保证在函数运行过程中包含打开文件和关闭文件两个操作，因为如果没有关闭文件的操作，winafl就无法对当前的输入文件进行变异。</span><br><span class="line">4.目标函数必须包含返回功能，即必须return，这样winafl才会进入下一轮的fuzz迭代。</span><br></pre></td></tr></table></figure>
<p>由于要fuzz的目标是GUI函数，因此不能保证程序一定会主动将输入文件关闭，幸运的是jisupdf程序在获取到文件的内容后立刻关闭了文件，嗯，非常好的编程习惯。但是依旧存在着一定的问题，因为用户的pdf界面是不会主动关掉的，需要用户手动关闭，这个可能会造成一些困扰，但是在使用winafl.dll进行独立测试时尚未出现问题，猜测可能在大规模fuzz过程中暴露出来。这里先稍微测试下 DynamoRIO 的插桩能力。</p>
<p>通过如下命令对目标程序进行程序覆盖率测试：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">E:\tools\DR\bin32&gt; .\drrun.exe -c ..\clients\lib32\release\drcov.dll -- E:\jisupdf\JisuPdf.exe</span><br></pre></td></tr></table></figure>
<p><strong>由于我是自己编译的 DynamoRIO，并且没有对tools选项进行配置，导致我的tools目录没有对应的插件，需要手动指定，这里的drcov.dll就是对目标程序进行覆盖率检测的client</strong></p>
<p>随后会自动在当前目录下生成一个log文件，这里得说明下<a href="https://www.freebuf.com/articles/system/216437.html" target="_blank" rel="noopener">模糊测试工具WinAFL使用指南</a>中的错误，-- 符号后面对应的是目标程序以及对应的参数，并不是要生成的覆盖率测试结果，这个当时给我造成了一定的困扰,😓。​在IDA中添加lighthouse插件即可查看对应的覆盖率，如下：</p>
<p><img src="/img/afl4.png" alt=""></p>
<p>当你分析程序的时候也会将函数着色，便于静态分析如下：</p>
<p><img src="/img/afl5.png" alt=""></p>
<p>接下来通过winafl的独立模式对要测试的目标模块以及偏移进行确定，命令如下：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">E:\tools\build\bin32&gt;drrun.exe -c winafl.dll -debug -verbose 1 -coverage_module JisuPdf.exe -target_module JisuPdf.exe -target_offset 0xfa750 -fuzz_iterations 2 -nargs 2 -- JisuPdf.exe FRC_4.5.3_DeviceCMYK_k.pdf</span><br></pre></td></tr></table></figure>
<p><strong>这里特别强调最好将drrun.exe、winafl.dll以及目标程序和测试文件放到同一个目录下，并且绝对不要使用绝对路径，这会导致一些问题，导致winafl无法正常工作</strong></p>
<p>最开始测试的时候将winafl.dll放到对应的目标程序下，并且在drrun.exe目录下使用绝对路径进行测试，一直没有成功，查看对应的输出log，发现并没有运行winafl定义的pre_fuzz_handler，如下图：</p>
<p><img src="/img/afl6.png" alt=""></p>
<p>很奇怪，目标函数没有命中，并且Coverage map的结果全是\x00，导致无法显示，但是程序已经运行起来了，并且也打开了要测试的pdf文件，为什么会出现这样的问题呢。最初以为是环境的问题，当我在多个win10、win7的版本上进行测试后，结果依旧如此，我猜测是否是自己编译的程序出现了问题，因为它用了win10最新的sdk version，是否和原程序不兼容，于是重新去<a href="https://github.com/ivanfratric/winafl" target="_blank" rel="noopener">这个网站</a>下了fork后的winafl，去<a href="https://github.com/DynamoRIO/dynamorio/releases" target="_blank" rel="noopener">这里</a>下了最新的DR release，重新编译进行测试，问题依旧存在，去github上搜索了issue，也并没有找到相关的问题，而且之前用drcov这个工具已经测试过覆盖率了，说明DynamoRIO是没有问题的，有问题的只能是winafl.dll，这样只能去读winafl.dll的源码了，使用VS2017打开项目，找到winafl的sources，查看代码，发现代码量并不大，程序逻辑也比较清晰，dll的入口函数是<b style="color: red ">dr_client_main</b>，粗略的看了下，函数刚开始对参数以及环境进行了初始化，随后通过调用<b style="color: red ">drmgr_register_module_load_event</b>函数注册了模块加载回调函数，每当有新的module加载到内存中时，都会调用回调函数，winafl在回调函数中的实现如下：</p>
<p><img src="/img/afl7.png" alt=""></p>
<p>首先会在log文件中输出对应的模块名称，随后查看加载的模块名称，同输入参数中的<code>target_module</code>名字做对比，这里存在问题，在实际调试过程中，发现传入的<code>options.fuzz_module</code>为完整路径，但是<code>module_name</code>为程序名称，因此两者并不匹配，所以<code>drwrap_wrap_ex(to_wrap, pre_fuzz_handler, post_fuzz_handler, NULL, options.callconv)</code>函数无法执行，导致两个钩子函数(<code>pre_fuzz_handler,post_fuzz_handler</code>)无法正常安装到目标程序上，所以出现上面的问题，因此将参数改为不包含路径的程序名称即可(需要将目标程序和fuzz程序放到同一目录)。</p>
<p>但是还有另外一个问题，coverage map无法正常显示，经过分析发现必须添加<code>-coverage_module</code>这个参数，仅仅是<code>-target_module</code>并不会进行覆盖率测试。最终正常结果如下：</p>
<p><img src="/img/afl8.png" alt=""></p>
<p>其中的数字代表着某个代码块的命中次数，详细的说明可以看afl的技术白皮书。</p>
<p>接下来就要用alf-fuzz主程序来fuzz目标了。首先是测试文件的搜集，具体可以参考以下网站：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">https://files.fuzzing-project.org/</span><br><span class="line">https://github.com/mozilla/pdf.js/tree/master/test/pdfs</span><br><span class="line">https://github.com/strongcourage/fuzzing-corpus/tree/master/pdf</span><br><span class="line">https://pdfium.googlesource.com/pdfium_tests/</span><br></pre></td></tr></table></figure>
<p><a href="http://xn--winafl-cmin-2u0rs6dm82ajna230hxo4aisl6yekv2fns1i.py" target="_blank" rel="noopener">搜集完样本后可以使用winafl-cmin.py</a> 对样本进行精简(Corpus distillation)，来进一步优化winafl的fuzz效率，命令如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">E:\tools\build\bin32&gt;python winafl-cmin.py </span><br><span class="line">-D E:\tools\build\bin32 </span><br><span class="line">-t 100000 </span><br><span class="line">-i pdfcase </span><br><span class="line">-o E:\tools\build\bin32\minset</span><br><span class="line">-covtype edge</span><br><span class="line">-coverage_module JisuPdf.exe</span><br><span class="line">-target_module JisuPdf.exe </span><br><span class="line">-target_offset 0xfa750 -nargs 2 -- JisuPdf.exe @@</span><br></pre></td></tr></table></figure>
<p>不出预料，果然出现了问题</p>
<img src="/img/afl9.png" style="zoom:60%;" />
<p>在测试过程中频繁出现目标卡死没有相应的情况，导致不得不手动关闭，为了找出程序没有响应的原因，尝试在运行过程中用windbg附加调试，找到对应的进程后利用windbg附加，可以，附加成功，接着利用<code>!analyze -v</code>指令来获取当前程序的状况，windbg显示出当前程序无响应的原因，如下：</p>
<p><img src="/img/test5.png" style="zoom:60%;" />)</p>
<p>😢,好吧，居然是程序主动的网络请求没有得到响应导致的程序被hang住，也太奇怪了吧。查看调用堆栈如下，很奇怪，底层堆栈似乎被破坏掉了，</p>
<p><img src="/img/afl11.png" alt=""></p>
<p>ida查看如下：</p>
<p><img src="/img/afl12.png" alt=""></p>
<p>查看其交叉引用，发现较多处调用，看来是一个发送网络请求的同用函数：</p>
<p><img src="/img/afl13.png" alt=""></p>
<p>由于windbg显示的函数堆栈已经被破坏了，所以要找到调用者比较麻烦，幸运的是我们有之前测试得到的函数coverage，配合idapython脚本可以进一步精简要找的调用函数地址，只有一个处于覆盖率图中的函数被调用，</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">codeaddr = askaddr(<span class="number">1</span>,<span class="string">"please input addr to search for xrefs to"</span>)</span><br><span class="line">    coderef = CodeRefsTo(codeaddr,<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">for</span> code <span class="keyword">in</span> coderef:</span><br><span class="line">        col = GetColor(code,CIC_ITEM)</span><br><span class="line">        <span class="keyword">if</span> col != <span class="number">0xffffffff</span>:</span><br><span class="line">            <span class="keyword">print</span> hex(code)</span><br></pre></td></tr></table></figure>
<p><img src="/img/afl14.png" alt=""></p>
<p>从格式上看是发送一些关于用户的信息，这里不在做深入的分析，可以通过patch或者其它方式让程序不再发送网络请求即可，但是后续的处理过程中依旧发现了和网络相关的程序hang问题，同样不做深入研究。</p>
<p>在接下来的fuzz过程中发现一些问题，afl-fuzz程序在初始化样本测试的时候产生崩溃导致无法进行后续的fuzz。根据官方提示，一般是选择函数的问题，因此我逆向了jisupdf整个创建文件的过程，并且对调用堆栈上的各个函数做好记录，用winafl.dll重新进行测试，当fuzz_iterations参数超过2时就会产生崩溃，查看对应的log文件，发现第一次fuzz没有问题，从第二次开始读取文件的路径竟然是空，因此推测winafl.dll对整个fuzz函数的环境没有正常恢复，导致读取不到测试目标文件，导致了测试程序crashed。因此，我重新在IDA中查看对应的函数反汇编代码，注意到如下信息：</p>
<p><img src="/img/afl15.png" alt=""></p>
<p>文件名称通过edx寄存器传递，嗯，这不是标准的stdcall，而是fastcall调用，难怪winafl无法恢复正常的上下文环境，幸好winafl.dll中提供了各类函数调用约定程序的hook，这样通过指定<code>-call_convention fastcall</code>参数即可让winafl正常工作，经过测试后发现确实程序可以正常工作了，但是存在一个问题就是程序并不会主动关闭打开的pdf页面，这回退出导致进程hang住，虽然afl-fuzz会主动将hang住的程序kill掉，但是这会造成巨大的性能开销，特别是现在遇到的问题，afl-fuzz首先使用havoc随机变异模式进行fuzz，但是部分文件格式不符合pdf的文件标准，导致程序弹出msgbox，这无法自动kill掉，因此afl-fuzz会主动关闭程序并重新打开测试，造成fuzz效率低下，这也是一个需要日后改进的地方，可以通过加载自己编写的post_handler来对数据进行处理，使其符合基本格式。运气不好的话，就会出现下面的结果：</p>
<p><img src="/img/test1.PNG" alt=""></p>
<p>当然，运气好的话就会这样：</p>
<p><img src="/img/test2.PNG" alt=""></p>
<p>两者的fuzz速度完全不一样，这一方面需要较好的样本，另一方面需要自己写好样本后处理程序，关于post_handler的介绍可以参考<a href="https://xz.aliyun.com/t/5108#toc-7" target="_blank" rel="noopener">这篇</a>文章，里面有着较为详细的说明，适当的阅读源码后会有更清晰的认识，这个在官方的说明文档中并没有提及，但在afl_post_library目录的文档中可以查到类似的实现以及说明。</p>
<p>最终经过长达9个多个小时的fuzz，出现一个崩溃，但是让我感到崩溃的是我当时为了调试DynamoRIO的异常崩溃设置windbg为即时调试器，导致jisupdf崩溃后windbg立刻附加，而winafl由于无法关闭子进程导致自己退出，这意味着又得重新开始fuzz了，😢。后续会详细分析下这个导致程序崩溃的样本，粗略的看了下，栈很有意思，可能是陷入了死循环中：</p>
<p><img src="/img/afl16.png" alt=""></p>
<p><img src="/img/afl17.png" alt=""></p>
<p>既然已经崩溃了，刚好可以测试编写的afl_post_handler，将编译好的dll放到特定目录，并设置好对应的环境变量 <code>AFL_POST_LIBRARY</code>即可，重新测试发现刚开始速度确实非常的快，不会在弹出无法识别pdf文件格式的msgbox,速度提高了不少。加上fuzz程序仅仅在我的测试虚拟机中工作，在单核的情况下有这种速度已经非常不错了，后续可以提高下系统的性能，应该会更快，等后面有空了会补上关于发现的crash的漏洞分析，目前先到这里。</p>
<p><img src="/img/test3.png" alt=""></p>

                <hr>
                

                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/2020/03/01/readnote/" data-toggle="tooltip" data-placement="top"
                           title="readnote">&larr; Previous Post</a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/2020/02/16/1234/" data-toggle="tooltip" data-placement="top"
                           title="读书笔记">Next Post &rarr;</a>
                    </li>
                    
                </ul>

                

                


                <!--加入新的评论系统-->
                

                

            </div>

            <div class="hidden-xs col-sm-3 toc-col">
                <div class="toc-wrap">
                    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#目前找到的部分关于winafl的研究"><span class="toc-text">目前找到的部分关于winafl的研究</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#关于fuzzing的简单介绍"><span class="toc-text">关于fuzzing的简单介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#使用winafl进行fuzz"><span class="toc-text">使用winafl进行fuzz</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#遇到的问题"><span class="toc-text">遇到的问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#选取jisupdf作为测试程序"><span class="toc-text">选取jisupdf作为测试程序</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#寻找攻击面"><span class="toc-text">寻找攻击面</span></a></li></ol></li></ol></li></ol>
                </div>
            </div>
        </div>

        <div class="row">
            <!-- Sidebar Container -->

            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                <!-- Featured Tags -->
                
                <section>
                    <!-- no hr -->
                    <h5 class="text-center">
                        <a href="/tags/">FEATURED TAGS</a>
                    </h5>
                    <div class="tags">
                        
                        <a class="tag" href="/tags/#fuzz"
                           title="fuzz">fuzz</a>
                        
                    </div>
                </section>
                

                <!-- Friends Blog -->
                
            </div>
        </div>

    </div>
</article>







<!-- Footer -->
<!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1 text-center">
                <br>
                <ul class="list-inline text-center">
                
                
                

                

                

                
                    <li>
                        <a target="_blank"  href="https://github.com/hackoflpf">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                

                </ul>
                <p class="copyright text-muted">
                    Copyright &copy; Hackoflpf 2020
                    <br>
                    <span id="busuanzi_container_site_pv" style="font-size: 12px;">PV: <span id="busuanzi_value_site_pv"></span> Times</span>
                    <br>
                    Theme by <a href="https://haojen.github.io/" target="_blank" rel="noopener">Haojen Ma</a>
                </p>

            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->

<script src="/js/jquery.min.js"></script>


<!-- Bootstrap Core JavaScript -->

<script src="/js/bootstrap.min.js"></script>


<!-- Custom Theme JavaScript -->

<script src="/js/blog.js"></script>


<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>

<!-- jquery.tagcloud.js -->
<script>
    // only load tagcloud.js in tag.html
    if($('#tag_cloud').length !== 0){
        async("http://hackoflpf.github.io/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                //size: {start: 1, end: 1, unit: 'em'},
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>

<!--fastClick.js -->
<script>
    async("//cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>



<!-- Google Analytics -->



<!-- Baidu Tongji -->


<!-- swiftype -->
<script type="text/javascript">
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
  (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
  e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

  _st('install','','2.0.0');
</script>

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<!--wechat title img-->
<img class="wechat-title-img" src="">
</body>

</html>
